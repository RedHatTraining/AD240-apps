FROM registry.access.redhat.com/ubi8/nodejs-14:1 as builder

COPY package.json package-lock.json /opt/app-root/src/

RUN npm ci --production

COPY . /opt/app-root/src/

RUN npm run build


FROM registry.access.redhat.com/ubi8/nodejs-14-minimal:1

COPY --from=builder /opt/app-root/src/node_modules /opt/app-root/src/node_modules

COPY --from=builder /opt/app-root/src/dist /opt/app-root/src/dist

EXPOSE 8080

CMD node dist/index.js 
